@startuml
title Order Saga - Delivery Failed

actor Buyer
participant "Order Service" as OrderSvc
queue "Event Bus\n(Kafka)" as Bus
participant "Inventory Service" as InvSvc
participant "Payment Service" as PaySvc
participant "Delivery Service" as DelivSvc
participant "Notification Service" as NotifSvc

Buyer -> OrderSvc: Create order
OrderSvc -> Bus: OrderPlaced

Bus -> InvSvc: OrderPlaced
InvSvc -> Bus: InventoryReserved

Bus -> PaySvc: InventoryReserved
PaySvc -> Bus: PaymentSucceeded

Bus -> DelivSvc: PaymentSucceeded
DelivSvc -> Bus: DeliveryRequestFailed

Bus -> PaySvc: DeliveryRequestFailed
PaySvc -> Bus: PaymentRefunded

Bus -> InvSvc: DeliveryRequestFailed
InvSvc -> Bus: InventoryReleased

Bus -> OrderSvc: DeliveryRequestFailed
OrderSvc -> Bus: OrderCancelled

Bus -> NotifSvc: DeliveryRequestFailed
Bus -> NotifSvc: OrderCancelled
@enduml
