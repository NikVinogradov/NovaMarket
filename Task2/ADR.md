### <a name="_b7urdng99y53"></a>**Название задачи:**
Просмотр истории покупок (агрегированная витрина заказов)
### <a name="_hjk0fkfyohdk"></a>**Автор:**
Виноградов Николай
### <a name="_uanumrh8zrui"></a>**Дата:**
2026-01-09

Контекст:
Покупателю необходим быстрый, агрегированный обзор «истории заказов» со списком заказов и подробным описанием
товаров, итогов, способа доставки и оплаты, а также окончательного статуса. Пользовательский интерфейс должен соответствовать
строгим целевым показателям задержки, в то время как платформа использует микросервисы и шину событий.
Служба заказов является оркестратором саги для рабочего процесса обработки заказов и уже генерирует
события предметной области.

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
|1|Покупатель, API Gateway, Order History Service|Просмотр списка заказов|Покупатель открывает раздел истории, система возвращает список заказов с суммой, датой, способом доставки и финальным статусом.|
|2|Покупатель, API Gateway, Order History Service|Просмотр деталей заказа|Покупатель выбирает заказ, система возвращает позиции с количеством и ценой, итоговую сумму, способы доставки и оплаты, финальный статус.|

|**№**|**Общие требования к системе**|
| :-: | :- |
|1|Отклик пользовательских интерфейсов не более 1 секунды в 99,99% случаев; 0,3 секунды в 98% случаев.|
|2|Масштабирование до 40 000+ заказов в день без деградации чтения истории заказов.|
|3|Микросервисная архитектура с событийным взаимодействием (EDA); интеграции через event bus.|
|4|Допускается eventual consistency для витрины истории заказов.|
|5|Возможность подключения новых сервисов по подписке на события без изменения существующих контрактов.|

### <a name="_qmphm5d6rvi3"></a>**Решение**
Для сценария "Просмотр истории покупок" используется CQRS:
введен Order History Service с собственной read model.
Сервис подписывается на события Order/Payment/Delivery через event bus (Kafka)
и строит денормализованную витрину для быстрых чтений.
API Gateway запрашивает историю и детали заказов напрямую
у Order History Service.

Диаграмма контейнеров (C2) отражена в `C4_Container_With_History.puml`.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**
1) API Composition на API Gateway (фан-аут в Order/Payment/Delivery/Catalog)
   - Плюсы: без дополнительного хранилища, проще пайплайн.
   - Минусы: высокий fan-out, вариативная задержка, сложные ретраи и сильная связанность.
2) Event Sourcing для Order Service
   - Плюсы: полный аудит, простые пересборки read models.
   - Минусы: высокая сложность внедрения, миграции и инструментарий.
